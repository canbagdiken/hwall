var API="http://bagdiken.com/demo/hwall/API/";function preSend(){$("#msg,#sendBtn").hide(),$("#loader").show()}function err(e){$(".msg").hide().html(e).removeClass("success").addClass("error").slideDown()}function suc(e){$(".msg").hide().html(e).removeClass("error").addClass("success").slideDown()}function afterSend(){loadList(),$("#msg,#sendBtn").show(),$("#loader").hide()}function loadList(){$.post(API+"list/",{token:$("body").attr("data-token")},function(){},"json").fail(function(e){err("Technical problem, please report!")}).success(function(e){$(".wall").html(""),$.each(e.list,function(e,n){console.log(n);var t=$("<span>").html(n.date),o=$("<p>").html(n.msg),s=$("<div>").appendTo($(".wall")).append(t).append(o);void 0!==n.id&&(s.append($("<button>").attr("data-id",n.id).html("X")),s.append($("<em>").html(n.ip)))})}).always(function(){})}$("document").ready(function(){loadList(),$("#sendBtn").click(function(){$("#msg").val().trim().length<1?err("Your message was empty :("):$("#msg").val().trim().length<5?err("Your message was too short :("):$("#msg").val().trim().length>250?err("Your message was too long :("):(preSend(),$.post(API+"send/",{msg:$("#msg").val()},function(){},"json").fail(function(e){err(e.msg)}).success(function(e){suc(e.msg)}).always(function(){afterSend()}))}),$(".wall").delegate("button","click",function(){1==confirm("Are you sure?")&&$.post(API+"delete/",{token:$("body").attr("data-token"),del:$(this).attr("data-id")},function(){},"json").fail(function(e){err("Technical problem, please report!")}).success(function(e){console.log(e.status),e.delete?(suc(e.msg),afterSend()):err(e.msg)}).always(function(){afterSend()})}),$("#login").click(function(){$("#manage").toggle()}),$("#loginBtn").click(function(){$("#manage").hide(),$("#pw").val().trim().length<1?err("Your password was empty :("):(preSend(),$.post(API+"login/",{pw:$("#pw").val()},function(){},"json").fail(function(e){err("Technical problem, please report!")}).success(function(e){console.log(e.status),e.login?($("body").attr("data-token",e.token),suc(e.msg),afterSend()):err(e.msg)}).always(function(){afterSend(),$("#pw").val("")}),console.log("ok"))})});